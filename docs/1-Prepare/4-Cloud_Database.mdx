---
id: cloud_databases
sidebar_position: 5
title: Cloud Database
custom_edit_url: null
---

## Pre-Requisites

- DB2 on Cloud Enterprise Edition

## Connecting to DB2 on Cloud from inside firewall

For on-prem installations of ADDI and RA servers, if there is a firewall blocking
access to DB2 on Cloud then a network security ticket will need to be opened.
Ideally, the network security team will open up the firewall directly to the DB2 on Cloud
host. In which case, you can proceed as normal.

In some cases, the network security team will create a "plug proxy" instead of opening the
firewall directly. They will then give you a proxy host and IP address to use that will 
then create a tunnel to connect to the DB2 host on the otherside of the firewall. This 
complicates the configuration.

Another important detail to keep in mind is that the DB2 host given by IBM Cloud is a 
load balancer. There are other actual IP addresses behind that load balancer IP. You will
need all hosts and IP addresses from DB2 on Cloud to configure connection through a plug
proxy.

For example, the nslookup command below shows all hosts and IP addresses for a DB2 on Cloud
load balancer host/ip combination.

```
âžœ  ~ nslookup bb54fad1-34c8-4d62-b5ea-3a11d91f3f3f.c3n41cmd0nqnrk39u98g.databases.appdomain.cloud
Server:         172.26.32.1
Address:        172.26.32.1#53

Non-authoritative answer:
bb54fad1-34c8-4d62-b5ea-3a11d91f3f3f.c3n41cmd0nqnrk39u98g.databases.appdomain.cloud     canonical name = db2-icd-prod-us-s-590130-4f0f9a5666e20005abfaee753b7e644d-0000.us-south.containers.appdomain.cloud.
db2-icd-prod-us-s-590130-4f0f9a5666e20005abfaee753b7e644d-0000.us-south.containers.appdomain.cloud      canonical name = db2-icd-prod-us-s-590130-4f0f9a5666e20005abfaee753b7e644d-0000.c3n41cmd0nqnrk39u98g.akadns.net.
Name:   db2-icd-prod-us-s-590130-4f0f9a5666e20005abfaee753b7e644d-0000.c3n41cmd0nqnrk39u98g.akadns.net
Address: 52.117.249.178
Name:   db2-icd-prod-us-s-590130-4f0f9a5666e20005abfaee753b7e644d-0000.c3n41cmd0nqnrk39u98g.akadns.net
Address: 169.48.136.34
Name:   db2-icd-prod-us-s-590130-4f0f9a5666e20005abfaee753b7e644d-0000.c3n41cmd0nqnrk39u98g.akadns.net
Address: 52.116.221.102
```

You will need to note not only the load balancer hostname but the actual hostname.

**Load balancer:** `bb54fad1-34c8-4d62-b5ea-3a11d91f3f3f.c3n41cmd0nqnrk39u98g.databases.appdomain.cloud`

**Actual:** `db2-icd-prod-us-s-590130-4f0f9a5666e20005abfaee753b7e644d-0000.c3n41cmd0nqnrk39u98g.akadns.net`

Let's now assume the plug proxy given is `plugproxy-xyz.customer.lab` and the 
IP is `10.1.70.150` and the DB2 hostnames above are to be used. The Windows `hosts` file 
needs to be configured as follows.

```
10.1.70.150 plugproxy-xyz.customer.lab
10.1.70.150 bb54fad1-34c8-4d62-b5ea-3a11d91f3f3f.c3n41cmd0nqnrk39u98g.databases.appdomain.cloud
10.1.70.150 db2-icd-prod-us-s-590130-4f0f9a5666e20005abfaee753b7e644d-0000.c3n41cmd0nqnrk39u98g.akadns.net
```

After configuring the `hosts` file (Found under `C:\Windows\System32\drivers\etc`), you will then
proceed to configure the connection to DB2 using `plugproxy-xyz.customer.lab` as the hostname.

## Installing/Configuring DB2 Client 

You will need the following:

- DB2 FQDN
- DB2 port 
- DB2 user 
- DB2 Password 

As of this writing you will need to open the webui for the DB2 cloud instance.

Open the webui and follow the below images

![CleanShot 2024-03-03 at 12 14 21](https://media.github.ibm.com/user/20330/files/5ffae607-c786-4c48-947e-51f370694581)

![CleanShot 2024-03-03 at 12 15 41](https://media.github.ibm.com/user/20330/files/ce46c70f-7edc-4317-823a-9f8a6892fdf4)

![CleanShot 2024-03-03 at 12 16 47](https://media.github.ibm.com/user/20330/files/8c4595c2-7a43-4b21-800d-1d50aad991a8)


1. Download Windows driver package
Download Windows driver package from driver [list](https://www.ibm.com/support/fixcentral/swg/quickorder?parent=ibm%2FInformation%20Management&product=ibm/Information+Management/IBM+Data+Server+Client+Packages&release=11.5.8.0&platform=Windows+64-bit,+x86&function=fixId&fixids=DSClients-ntx64-dsdriver-11.5.9000.352-FP000&includeRequisites=1&includeSupersedes=0&downloadMethod=http&source=fc)
File name: ibm_data_server_driver_package_win64_v11.5.exe (104 MB)
2. Install the drivers by running the `ibm_data_server_driver_package_win64_v11.5.exe` file as an administrator.
3. In The Connection configuration resources section, select whether or not you want to secure your connections by using SSL.
If your application uses its own driver and you want to connect with SSL, download the SSL certificate (DigiCertGlobalRootCA.crt).
For Java apps, use the JDBC string as the database URL in your call to the JDBC getConnection method.
For ODBC apps, add new entries to the db2dsdriver.cfg driver configuration file by running the following commands:
	
Determine the FQDN of your DB2 on Cloud instance:

From the above image our example FQDN for DB2 is `3b84375f-36fb-42b0-8241-ac0e7840e5dc.bpe60pbd01oinge4psd0.databases.appdomain.cloud` and our port is `31838`.

Once you have the instance up and you have the FQDN, run the following db2 local config commands in Powershell on the ADDI Host as illustrated from the db2 webui:

```powershell
db2cli writecfg add -database bludb -host 3b84375f-36fb-42b0-8241-ac0e7840e5dc.bpe60pbd01oinge4psd0.databases.appdomain.cloud-port 31838
db2cli writecfg add -dsn dashdb -database bludb -host3b84375f-36fb-42b0-8241-ac0e7840e5dc.bpe60pbd01oinge4psd0.databases.appdomain.cloud -port 31838
db2cli writecfg add -database bludb -host 3b84375f-36fb-42b0-8241-ac0e7840e5dc.bpe60pbd01oinge4psd0.databases.appdomain.cloud-port 31838 -parameter "SecurityTransportMode=SSL"
```

In the webui for DB2, let's also create a user to admin this database:

![CleanShot 2024-03-03 at 12 30 49](https://media.github.ibm.com/user/20330/files/606791f4-a38b-4975-bdb0-54bc76ec766e)

In our case, we created a user called `wca4z_db2` and gave him the password `yhJ_sBvn7qx-B6YXJjBA`

![CleanShot 2024-03-03 at 12 33 48](https://media.github.ibm.com/user/20330/files/5854e74c-5b89-4645-99af-aeff51c6cb61)

## Configure ADDI for DB2

[`db2configuration.bat`](/deployment_files/db2configuration.bat)

Download the above script and run it with your DB2 FQDN. At this point you should have the FQDN, port, User, and password.

```powershell
PS D:\> .\db2configuration.bat dbName=BLUDB db2Host=3b84375f-36fb-42b0-8241-ac0e7840e5dc.bpe60pbd01oinge4psd0.databases.appdomain.cloud db2Port=31838 db2User=wca4z_db2 db2Password=yhJ_sBvn7qx-B6YXJjBA useTLS=true
Adding new DB2 database instance into ADDI
Success.
```

This will add the appropriate entries into ADDI.